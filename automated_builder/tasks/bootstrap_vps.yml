---
- name: Bootstrap VPS
  hosts: vps_runner
  gather_facts: true
  vars_files:
    - ../vars/secrets.yml
    - ../vars/main.yml

  tasks:
    - name: Create ansible user with SSH permissions
      block:
        - name: Create ansible user
          user:
            name: ansible
            group: sudo

        - name: Copy authorized_keys
          copy:
            remote_src: /root/.ssh/authorized_keys
            dest: /home/ansible/authorized_keys

        - name: Allow passwordless sudo commands
          sudoers:
            name: ansible
            commands: all
      become: true
