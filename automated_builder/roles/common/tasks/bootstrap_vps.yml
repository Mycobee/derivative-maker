---
- name: Bootstrap VPS
  become: true
  vars:
    ansible_ssh_user: root
  block:
    - name: Create ansible user
      user:
        name: ansible
        group: sudo

    - name: register ssh directory
      shell: "ls -la /root/.ssh"
      register: ssh_contents

    - name: inspect ssh contents
      debug:
        var: ssh_contents
    - name: Copy authorized_keys
      copy:
        remote_src: /root/.ssh/authorized_keys
        dest: /home/ansible/authorized_keys
        owner: ansible
        group: ansible

    - name: Allow passwordless sudo commands
      community.general.sudoers:
        name: ansible
        commands: ALL
